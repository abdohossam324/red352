# توثيق تطبيق بنّاء (Benaa App)

## 1. نظرة عامة على المشروع
**تطبيق بنّاء** هو تطبيق للهاتف المحمول مبني باستخدام إطار عمل **Flutter**، ويعمل كسوق للخدمات والمنتجات. يهدف التطبيق إلى تسهيل الربط بين المستخدمين (طالبي الخدمة) ومقدمي الخدمات أو البائعين. يمكن للمستخدمين تصفح الخدمات، مشاهدة الإعلانات، نشر إعلاناتهم الخاصة (خدمات أو منتجات)، والتواصل عبر المحادثات الفورية.

يدعم التطبيق اللغتين العربية والإنجليزية (باستخدام `EasyLocalization`) ويعتمد على **Clean Architecture** مع **BLoC** لإدارة الحالة (State Management).

## 2. الميزات الرئيسية

### 2.1 المصادقة (`features/auth`)
يتميز التطبيق بنظام مصادقة قوي:
-   **تسجيل الدخول برقم الهاتف**: يسجل المستخدمون الدخول باستخدام أرقام هواتفهم.
-   **التحقق عبر OTP**: يتم إرسال رمز تحقق مكون من 4 أرقام.
-   **تسجيل الدخول التلقائي**: يتذكر التطبيق جلسة المستخدم (`AutoLoginCubit`) ويتجاوز شاشات تسجيل الدخول إذا كان "Token" المستخدم صالحًا.
-   **وضع الزائر**: يمكن للمستخدمين استكشاف التطبيق دون حساب (`AutoLoginGeustMode`)، مع تقييد بعض الميزات (مثل نشر الإعلانات أو المحادثة).

### 2.2 الرئيسية والتنقل (`features/home`)
تعتبر `MainScreen` المحور الرئيسي للتطبيق وتحتوي على شريط تنقل سفلي:
-   **الرئيسية (Home)**: تعرض قوائم الخدمات والمنتجات.
-   **إعلاناتي (`myAdv`)**: تتيح للمستخدمين إدارة إعلاناتهم المنشورة.
-   **الإشعارات (Notifications)**: تعرض التحديثات والتنبيهات.
-   **المحادثات (Chat)**: للوصول إلى محادثات المستخدمين.
-   **زر الإجراء العائم (+)**: زر مركزي للقيام بـ:
    -   طلب خدمة.
    -   إضافة منتج، أداة، أو أثاث.

### 2.3 الإعلانات (`features/advetisment`, `features/actionads`)
-   **عرض الإعلانات**: يمكن للمستخدمين تصفح فئات مختلفة من الإعلانات.
-   **نشر الإعلانات**: تتيح عملية "الإضافة" للمستخدمين إنشاء قوائم جديدة. يتضمن ذلك نموذجًا متعدد الخطوات (Stepper) لجمع التفاصيل مثل الصور، الوصف، السعر، والفئة.

### 2.4 نظام المحادثة (`features/chat`)
-   **مراسلة فورية**: يمكن للمستخدمين الدردشة مع مقدمي الخدمات أو البائعين.
-   **شارات غير المقروءة**: يعرض شريط التنقل عدد الرسائل غير المقروءة.

### 2.5 الإشعارات (`features/notification`)
-   **إشعارات داخل التطبيق**: يتلقى المستخدمون تحديثات حول طلباتهم، إعلاناتهم، أو رسائل الدردشة.
-   **عداد الشارات**: يعرض عدد الإشعارات غير المقروءة على أيقونة التبويب.

### 2.6 التعريب (Localization)
-   التطبيق معرب بالكامل (العربية/الخليزية) باستخدام مكتبة `easy_localization`.
-   يتم عرض اختيار اللغة عند التشغيل لأول مرة إذا لم يتم تعيينها مسبقًا.

## 3. المعمارية التقنية (Technical Architecture)

يتبع المشروع مبادئ **Clean Architecture**، حيث يفصل بين الاهتمامات إلى ثلاث طبقات رئيسية لكل ميزة:

1.  **طبقة العرض (Presentation Layer)**:
    -   **Pages**: شاشات واجهة المستخدم (مثل `MainScreen`, `SignInScreen`).
    -   **Widgets**: مكونات واجهة المستخدم القابلة لإعادة الاستخدام.
    -   **Cubit/Bloc**: يتعامل مع إدارة الحالة ومنطق واجهة المستخدم (مثل `AutoLoginCubit`, `GetNotificationCubit`).
2.  **طبقة المجال (Domain Layer)** - الطبقة الداخلية:
    -   **Entities**: كائنات Dart نقية تمثل البيانات (مثل `UserResponse`).
    -   **Use Cases**: تغلف قواعد العمل المحددة (مثل `AutoLoginUseCase`).
    -   **Repositories (Interfaces)**: تعريفات مجردة لعمليات البيانات.
3.  **طبقة البيانات (Data Layer)**:
    -   **Models**: كائنات نقل البيانات (DTOs) مع تسلسل JSON (مثل `UserModel`).
    -   **Repositories (Implementations)**: التنفيذ الفعلي لجلب البيانات.
    -   **Data Sources**:
        -   **Remote**: استدعاءات API باستخدام `Dio`.
        -   **Local**: التخزين المحلي باستخدام `SharedPreferences`.

### 3.1 الوحدة الأساسية (`lib/core`)
تحتوي على الموارد المشتركة المستخدمة عبر الميزات:
-   **`api_basehelper.dart`**: غلاف حول `Dio` للتعامل مع طلبات HTTP، المعترضات (interceptors)، ومعالجة الأخطاء.
-   **`injection_container.dart`**: إعداد محدد موقع الخدمة (Service Locator) باستخدام `get_it` لإدارة التبعيات (DI).
-   **`util/`**: أدوات مساعدة محددة.
-   **`widgets/`**: عناصر واجهة مستخدم مشتركة مثل `CustomButton`، ومؤشرات التحميل، وما إلى ذلك.

### 3.2 التبعيات الرئيسية (Key Dependencies)
-   **State Management**: `flutter_bloc`
-   **Networking**: `dio`
-   **DI**: `get_it`
-   **Navigation**: `flutter_bloc` (listeners) & `Navigator`
-   **Maps**: `google_maps_flutter`, `geolocator`
-   **Firebase**: `firebase_messaging`, `firebase_core` (للإشعارات والتحليلات)
-   **Storage**: `shared_preferences`

## 4. الإعداد والتشغيل

1.  **المتطلبات الأساسية**: تثبيت Flutter SDK.
2.  **تثبيت التبعيات**:
    ```bash
    flutter pub get
    ```
3.  **تشغيل التطبيق**:
    ```bash
    flutter run
    ```
4.  **بناء نسخة الإصدار (Release)**:
    ```bash
    flutter build apk
    ```

## 5. هيكلية المجلدات
```
lib/
├── core/               # الأدوات المشتركة، العناصر، معالجة الأخطاء
├── features/           # وحدات الميزات (Auth, Home, Chat, etc.)
│   ├── auth/
│   ├── home/
│   ├── chat/
│   ├── actionads/
│   └── ...
├── injection_container.dart # إعداد حقن التبعيات (DI)
├── main.dart           # نقطة دخول التطبيق
└── benna_app.dart      # الأداة الجذرية (MaterialApp, Global Providers)
```
